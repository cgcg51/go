def run(self):
        while True:
            ret, frame = self cap read()
            if not ret:
                break
                
            # 转换为灰度图像用于检测
            gray = cv2 cvtColor(frame, cv2 COLOR_BGR2GRAY)
            
            # 检测人脸
            faces = self detector(gray)
            
            for face in faces:
                # 获取面部关键点
                face_points = self predictor(gray, face)
                
                # 获取嘴唇关键点
                lip_points = self get_lip_points(face_points)
                
                # 添加到缓冲区用于平滑
                self lip_points_buffer append(lip_points)
                
                # 计算平均嘴唇位置（平滑效果）
                if len(self lip_points_buffer) > 1:
                    avg_lip_points = np mean(self lip_points_buffer, axis=0) astype(np int32)
                    # 重塑为正确的形状
                    avg_lip_points = avg_lip_points reshape(-1, 2)
                    self apply_lipstick(frame, avg_lip_points)
                else:
                    self apply_lipstick(frame, lip_points)
